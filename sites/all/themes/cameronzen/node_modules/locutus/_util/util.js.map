{"version":3,"sources":["../../src/_util/util.js"],"names":[],"mappings":"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","file":"util.js","sourcesContent":["var globby = require('globby')\nvar path = require('path')\nvar fs = require('fs')\nvar async = require('async')\nvar YAML = require('js-yaml')\nvar mkdirp = require('mkdirp')\nvar debug = require('depurar')('locutus')\nvar indentString = require('indent-string')\nvar _ = require('lodash')\n\nclass Util {\n  constructor (argv) {\n    if (!argv) {\n      argv = []\n    }\n    this.__src = path.dirname(__dirname)\n    this.__root = path.dirname(path.dirname(__dirname))\n    this.__test = path.dirname(path.dirname(__dirname)) + '/test'\n\n    this.globals = {}\n\n    this.pattern = [this.__src + '/**/**/*.js', '!**/index.js', '!**/_util/**']\n    this.concurrency = 8\n    this.authorKeys = [\n      'original by',\n      'improved by',\n      'reimplemented by',\n      'parts by',\n      'bugfixed by',\n      'revised by',\n      'input by'\n    ]\n\n    this.langDefaults = {\n      c: {\n        order: 1,\n        function_title_template: '[language]\\'s [category].[function] in JavaScript',\n        human: 'C',\n        packageType: 'header file',\n        inspiration_urls: [\n          '<a href=\"http://en.cppreference.com/w/c/numeric/math\">the C math.h documentation</a>',\n          '<a href=\"https://sourceware.org/git/?p=glibc.git;a=tree;f=math;hb=HEAD\">the C math.h source</a>'\n        ],\n        function_description_template: 'Here’s what our current JavaScript equivalent to <a href=\"http://en.cppreference.com/w/c/numeric/[category]/[function]\">[language]\\'s [function] found in the [category].h header file</a> looks like.'\n      },\n      golang: {\n        order: 2,\n        function_title_template: '[language]\\'s [category].[function] in JavaScript',\n        human: 'Go',\n        packageType: 'package',\n        inspiration_urls: [\n          '<a href=\"https://golang.org/pkg/strings/\">Go strings documentation</a>',\n          '<a href=\"https://golang.org/src/strings/strings.go\">Go strings source</a>',\n          '<a href=\"https://golang.org/src/strings/example_test.go\">Go strings examples source</a>',\n          '<a href=\"http://gophersjs.com\">GopherJS</a>'\n        ],\n        function_description_template: 'Here’s what our current JavaScript equivalent to <a href=\"https://golang.org/pkg/[category]/#[function]\">[language]\\'s [category].[function]</a> looks like.'\n      },\n      python: {\n        order: 3,\n        function_title_template: '[language]\\'s [category].[function] in JavaScript',\n        human: 'Python',\n        packageType: 'module',\n        inspiration_urls: [\n          '<a href=\"https://docs.python.org/3/library/string.html\">the Python 3 standard library string page</a>'\n        ],\n        function_description_template: 'Here’s what our current JavaScript equivalent to <a href=\"https://docs.python.org/3/library/[category].html#[category].[function]\">[language]\\'s [category].[function]</a> looks like.'\n      },\n      ruby: {\n        order: 4,\n        function_title_template: '[language]\\'s [category].[function] in JavaScript',\n        human: 'Ruby',\n        packageType: 'module',\n        inspiration_urls: [\n          '<a href=\"http://ruby-doc.org/core-2.2.2/Math.html\">the Ruby core documentation</a>'\n        ],\n        function_description_template: 'Here’s what our current JavaScript equivalent to <a href=\"http://ruby-doc.org/core-2.2.2/[category].html#method-c-[function]\">[language]\\'s [category].[function]</a> looks like.'\n      },\n      php: {\n        order: 5,\n        function_title_template: '[language]\\'s [function] in JavaScript',\n        human: 'PHP',\n        packageType: 'extension',\n        inspiration_urls: [\n          '<a href=\"http://php.net/manual/en/book.strings.php\">the PHP string documentation</a>',\n          '<a href=\"https://github.com/php/php-src/blob/master/ext/standard/string.c#L5338\">the PHP string source</a>',\n          '<a href=\"https://github.com/php/php-src/blob/master/ext/standard/tests/strings/str_pad_variation1.phpt\">a PHP str_pad test</a>'\n        ],\n        function_description_template: 'Here’s what our current JavaScript equivalent to <a href=\"http://php.net/manual/en/function.[functiondashed].php\">[language]\\'s [function]</a> looks like.',\n        alias: [\n          '/categories/',\n          '/categories/array/',\n          '/categories/bc/',\n          '/categories/ctype/',\n          '/categories/datetime/',\n          '/categories/exec/',\n          '/categories/filesystem/',\n          '/categories/funchand/',\n          '/categories/i18n/',\n          '/categories/index/',\n          '/categories/info/',\n          '/categories/json/',\n          '/categories/math/',\n          '/categories/misc/',\n          '/categories/net/',\n          '/categories/network/',\n          '/categories/pcre/',\n          '/categories/strings/',\n          '/categories/url/',\n          '/categories/var/',\n          '/categories/xdiff/',\n          '/categories/xml/',\n          '/functions/index/',\n          '/functions/',\n          '/packages/',\n          '/packages/index/'\n        ]\n      }\n    }\n\n    this.allowSkip = (argv.indexOf('--noskip') === -1)\n\n    this._reindexBuffer = {}\n    this._injectwebBuffer = {}\n  }\n\n  injectweb (cb) {\n    var self = this\n    this._runFunctionOnAll(this._injectwebOne, function (err) {\n      if (err) {\n        return cb(err)\n      }\n      for (var indexHtml in self._injectwebBuffer) {\n        debug('writing: ' + indexHtml)\n        fs.writeFileSync(indexHtml, self._injectwebBuffer[indexHtml], 'utf-8')\n      }\n    })\n  }\n\n  reindex (cb) {\n    var self = this\n    self._reindexBuffer = {}\n    self._runFunctionOnAll(self._reindexOne, function (err) {\n      if (err) {\n        return cb(err)\n      }\n      for (var indexJs in self._reindexBuffer) {\n        var requires = self._reindexBuffer[indexJs]\n        requires.sort()\n        debug('writing: ' + indexJs)\n        fs.writeFileSync(indexJs, requires.join('\\n') + '\\n', 'utf-8')\n      }\n    })\n  }\n\n  writetests (cb) {\n    this._runFunctionOnAll(this._writetestOne, cb)\n  }\n\n  _runFunctionOnAll (runFunc, cb) {\n    var self = this\n\n    var q = async.queue(function (fullpath, callback) {\n      self._load.bind(self, fullpath, {}, function (err, params) {\n        if (err) {\n          return callback(err)\n        }\n\n        runFunc.bind(self, params, callback)()\n      })()\n    }, self.concurrency)\n\n    debug({\n      pattern: self.pattern\n    })\n    var files = globby.sync(self.pattern)\n\n    q.push(files)\n\n    q.drain = cb\n  }\n\n  _reindexOne (params, cb) {\n    var fullpath = this.__src + '/' + params.filepath\n    var dir = path.dirname(fullpath)\n    var basefile = path.basename(fullpath, '.js')\n    var indexJs = dir + '/index.js'\n\n    var module = basefile\n    if (basefile === 'Index2') {\n      module = 'Index'\n    }\n\n    if (!this._reindexBuffer[indexJs]) {\n      this._reindexBuffer[indexJs] = []\n    }\n\n    var line = 'module.exports[\\'' + module + '\\'] = require(\\'./' + basefile + '\\')'\n    this._reindexBuffer[indexJs].push(line)\n    return cb(null)\n  }\n\n  _injectwebOne (params, cb) {\n    var authors = {}\n    this.authorKeys.forEach(function (key) {\n      if (params.headKeys[key]) {\n        authors[key] = _.flattenDeep(params.headKeys[key])\n      }\n    })\n\n    var langPath = [\n      this.__root,\n      '/website/source/',\n      params.language\n    ].join('')\n\n    var langIndexPath = langPath + '/index.html'\n    var catPath = langPath + '/' + params.category\n    var catIndexPath = catPath + '/' + 'index.html'\n    var funcPath = catPath + '/' + params.func_name + '.html'\n\n    if (!this._injectwebBuffer[langIndexPath]) {\n      var langTitle = ''\n      langTitle += this.langDefaults[params.language].human + ' '\n      langTitle += this.langDefaults[params.language].packageType + 's '\n      langTitle += ' in JavaScript'\n\n      var langData = Object.assign({}, this.langDefaults[params.language], {\n        warning: 'This file is auto generated by `npm run web:inject`, do not edit by hand',\n        type: 'language',\n        layout: 'language',\n        language: params.language,\n        title: langTitle\n      })\n      this._injectwebBuffer[langIndexPath] = '---' + '\\n' + YAML.safeDump(langData).trim() + '\\n' + '---' + '\\n'\n    }\n\n    if (!this._injectwebBuffer[catIndexPath]) {\n      var catTitle = ''\n      catTitle += this.langDefaults[params.language].human + '\\'s '\n      catTitle += params.category + ' '\n      catTitle += this.langDefaults[params.language].packageType + ' '\n      catTitle += ' in JavaScript'\n\n      var catData = {\n        warning: 'This file is auto generated by `npm run web:inject`, do not edit by hand',\n        type: 'category',\n        layout: 'category',\n        language: params.language,\n        category: params.category,\n        title: catTitle\n      }\n      this._injectwebBuffer[catIndexPath] = '---' + '\\n' + YAML.safeDump(catData).trim() + '\\n' + '---' + '\\n'\n    }\n\n    var functionTitle = this.langDefaults[params.language].function_title_template\n      .replace(/\\[language\\]/g, this.langDefaults[params.language].human)\n      .replace(/\\[category\\]/g, params.category)\n      .replace(/\\[function\\]/g, params.func_name)\n      .replace(/\\[functiondashed\\]/g, params.func_name.replace(/_/g, '-'))\n\n    var functionDescription = this.langDefaults[params.language].function_description_template\n      .replace(/\\[language\\]/g, this.langDefaults[params.language].human)\n      .replace(/\\[category\\]/g, params.category)\n      .replace(/\\[function\\]/g, params.func_name)\n      .replace(/\\[functiondashed\\]/g, params.func_name.replace(/_/g, '-'))\n\n    var funcData = {\n      warning: 'This file is auto generated by `npm run web:inject`, do not edit by hand',\n      examples: (params.headKeys.example || []).map(function (lines, i) {\n        return lines.join('\\n')\n      }),\n      estarget: (params.headKeys.estarget || []).map(function (lines, i) {\n        return lines.join('\\n')\n      }).join('\\n').trim() || 'es5',\n      returns: (params.headKeys.returns || []).map(function (lines, i) {\n        return lines.join('\\n')\n      }),\n      dependencies: [],\n      authors: authors || {},\n      notes: (params.headKeys.note || []).map(function (lines, i) {\n        return lines.join('\\n')\n      }),\n      type: 'function',\n      layout: 'function',\n      title: functionTitle,\n      description: functionDescription,\n      function: params.func_name,\n      category: params.category,\n      language: params.language,\n      permalink: params.language + '/' + params.category + '/' + params.func_name + '/',\n      alias: [\n        '/functions/' + params.language + '/' + params.func_name + '/',\n        '/functions/' + params.category + '/' + params.func_name + '/',\n        '/' + params.language + '/' + params.func_name + '/'\n      ]\n    }\n\n    if (params.language === 'php') {\n      funcData.alias.push('/functions/' + params.func_name + '/')\n    }\n\n    var buf = '---' + '\\n' + YAML.safeDump(funcData).trim() + '\\n' + '---' + '\\n'\n\n    buf += `{% codeblock lang:javascript %}${params.code}{% endcodeblock %}`\n\n    mkdirp(path.dirname(funcPath), function (err) {\n      if (err) {\n        throw new Error('Could not mkdir  for ' + funcPath + '. ' + err)\n      }\n      fs.writeFile(funcPath, buf, 'utf-8', cb)\n    })\n  }\n\n  _addRequire (name, relativeSrcForTest) {\n    return [\n      'var ',\n      name,\n      ' = require(\\'',\n      relativeSrcForTest,\n      '\\') // eslint-disable-line no-unused-vars,camelcase'\n    ].join('')\n  }\n\n  _writetestOne (params, cb) {\n    var self = this\n\n    if (!params.func_name) {\n      throw new Error('No func_name in ' + JSON.stringify(params))\n    }\n    if (!params.headKeys) {\n      throw new Error('No headKeys in ' + params.func_name)\n    }\n    if (!params.headKeys.example) {\n      throw new Error('No example in ' + params.func_name)\n    }\n\n    var basename = path.basename(params.filepath)\n    var subdir = path.dirname(params.filepath)\n    var testpath = this.__test + '/languages/' + subdir + '/test-' + basename\n    var testdir = path.dirname(testpath)\n    var relativeSrcForTestDir = path.relative(testdir, self.__src)\n    var relativeTestFileForRoot = path.relative(self.__root, testpath)\n\n    // console.log(relativeSrcForTestDir)\n    // process.exit(1)\n\n    var testProps = ''\n    if (params.headKeys.test) {\n      testProps = params.headKeys.test[0][0]\n    }\n\n    var describeSkip = ''\n    if (self.allowSkip && testProps.indexOf('skip-all') !== -1) {\n      describeSkip = '.skip'\n    }\n\n    var codez = []\n\n    codez.push('// warning: This file is auto generated by `npm run build:tests`')\n    codez.push('// Do not edit by hand!')\n\n    // Add globals\n    for (var global in self.globals) {\n      codez.push('var ' + global + ' = ' + self.globals[global])\n    }\n\n    // Set timezone for testing dates\n    // Not ideal: http://stackoverflow.com/questions/8083410/how-to-set-default-timezone-in-node-js\n    codez.push('process.env.TZ = \\'UTC\\'')\n\n    codez.push('var ' + 'expect' + ' = require(\\'chai\\').expect')\n\n    // Add language-wide dependencies\n    // @todo: It would be great if we could remove this\n    if (params.language === 'php') {\n      codez.push(self._addRequire('ini_set', relativeSrcForTestDir + '/' + 'php/info/ini_set'))\n      codez.push(self._addRequire('ini_get', relativeSrcForTestDir + '/' + 'php/info/ini_get'))\n      if (params.func_name === 'localeconv') {\n        codez.push(self._addRequire(\n          'setlocale',\n          relativeSrcForTestDir + '/' + 'php/strings/setlocale'\n        ))\n      }\n      if (params.func_name === 'i18n_loc_get_default') {\n        codez.push(self._addRequire(\n          'i18n_loc_set_default',\n          relativeSrcForTestDir + '/' + 'php/i18n/i18n_loc_set_default'\n        ))\n      }\n    }\n\n    // Add the main function to test\n    codez.push(self._addRequire(\n      params.func_name,\n      relativeSrcForTestDir + '/' + params.filepath\n    ))\n\n    codez.push('')\n\n    codez.push([\n      'describe',\n      describeSkip,\n      '(\\'src/',\n      params.filepath,\n      ' (tested in ',\n      relativeTestFileForRoot,\n      ')\\', function () {'\n    ].join(''))\n\n    // Run each example\n    for (var i in params.headKeys.example) {\n      if (!params.headKeys.returns[i] || !params.headKeys.returns[i].length) {\n        throw new Error('There is no return for example ' + i, test, params)\n      }\n\n      var humanIndex = parseInt(i, 10) + 1\n      var itSkip = ''\n      if (self.allowSkip && testProps.indexOf('skip-' + humanIndex) !== -1) {\n        itSkip = '.skip'\n      }\n\n      codez.push([\n        '  it',\n        itSkip,\n        '(\\'should pass example ',\n        (humanIndex),\n        '\\', function (done) {'\n      ].join(''))\n\n      var body = []\n\n      var testExpected = params.headKeys.returns[i].join('\\n')\n\n      body.push('var expected = ' + testExpected)\n\n      // Execute line by line (see date.js why)\n      // We need result be the last result of the example code\n      for (var j in params.headKeys.example[i]) {\n        if (parseInt(j, 10) === params.headKeys.example[i].length - 1) {\n          // last action gets saved\n          body.push('var result = ' + params.headKeys.example[i][j].replace('var $result = ', ''))\n        } else {\n          body.push(params.headKeys.example[i][j])\n        }\n      }\n\n      body.push('expect(result).to.deep.equal(expected)')\n      body.push('done()')\n\n      codez.push(indentString(body.join('\\n'), ' ', 4))\n\n      codez.push('  })')\n    }\n\n    codez.push('})')\n    codez.push('')\n\n    var code = codez.join('\\n')\n\n    // Write to disk\n    mkdirp(testdir, function (err) {\n      if (err) {\n        throw new Error(err)\n      }\n      debug('writing: ' + testpath)\n      fs.writeFile(testpath, code, 'utf-8', cb)\n    })\n  }\n\n  // Environment-specific file opener. function name needs to\n  // be translated to code. The difficulty is in finding the\n  // category.\n  _opener (fileOrName, requesterParams, cb) {\n    var self = this\n    var pattern\n\n    var language = requesterParams.language || '*'\n\n    if (path.basename(fileOrName, '.js').indexOf('.') !== -1) {\n      // periods in the basename, like: unicode.utf8.RuneCountInString or strings.sprintf\n      pattern = self.__src + '/' + language + '/' + fileOrName.replace(/\\./g, '/') + '.js'\n    } else if (fileOrName.indexOf('/') === -1) {\n      // no slashes, like: sprintf\n      pattern = self.__src + '/' + language + '/*/' + fileOrName + '.js'\n    } else if (fileOrName.substr(0, 1) === '/') {\n      // absolute path, like: /Users/john/code/locutus/php/strings/sprintf.js\n      pattern = fileOrName\n    } else {\n      // relative path, like: php/strings/sprintf.js\n      pattern = self.__src + '/' + fileOrName\n    }\n\n    pattern = pattern.replace('golang/strings/Index.js', 'golang/strings/Index2.js')\n    debug('loading: ' + pattern)\n    var files = globby.sync(pattern, {})\n\n    if (files.length !== 1) {\n      var msg = `Found ${files.length} occurances of ${fileOrName} via pattern: ${pattern}`\n      return cb(new Error(msg))\n    }\n\n    var filepath = files[0]\n\n    if (path.basename(filepath) === 'index.js') {\n      return cb(null)\n    }\n\n    if (!filepath) {\n      return cb(new Error('Could not find ' + pattern))\n    }\n\n    fs.readFile(filepath, 'utf-8', function (err, code) {\n      if (err) {\n        return cb(new Error('Error while opening ' + filepath + '. ' + err))\n      }\n      return cb(null, filepath, code)\n    })\n  }\n\n  _load (fileOrName, requesterParams, cb) {\n    var self = this\n    self._opener(fileOrName, requesterParams, function (err, fullpath, code) {\n      if (err) {\n        return cb(err)\n      }\n\n      var filepath = path.relative(self.__src, fullpath)\n      self._parse(filepath, code, cb)\n    })\n  }\n\n  _findDependencies (fileOrName, requesterParams, dependencies, cb) {\n    var self = this\n\n    if (!requesterParams.headKeys['depends on'] || !requesterParams.headKeys['depends on'].length) {\n      if (cb) {\n        cb(null, {})\n      }\n      return\n    }\n\n    var i\n    var depCodePath\n    var loaded = 0\n    for (i in requesterParams.headKeys['depends on']) {\n      depCodePath = requesterParams.headKeys['depends on'][i][0]\n\n      self._load(depCodePath, requesterParams, function (err, params) {\n        if (err) {\n          return cb(err)\n        }\n\n        dependencies[depCodePath] = params\n        self._findDependencies(depCodePath, params, dependencies)\n\n        if (cb && ++loaded === requesterParams.headKeys['depends on'].length) {\n          cb(null, dependencies)\n        }\n      })\n    }\n  }\n\n  _parse (filepath, code, cb) {\n    if (!code) {\n      return cb(new Error('Unable to parse ' + filepath + '. Received no code'))\n    }\n\n    if (filepath.indexOf('/') === -1) {\n      return cb(new Error('Parse only accepts relative filepaths. Received: \\'' + filepath + '\\''))\n    }\n\n    var parts = filepath.split('/')\n    var language = parts.shift()\n    var codepath = parts.join('.')\n    var name = parts.pop()\n    var category = parts.join('.')\n\n    var patFuncStart = /^\\s*module\\.exports = function\\s*([^\\s)]+)\\s*\\(([^\\)]*)\\)\\s*\\{\\s*/i\n    var patFuncEnd = /\\s*}\\s*$/\n    var commentBlocks = this._commentBlocks(code)\n\n    if (!commentBlocks[0]) {\n      var msg = `Unable to parse ${filepath}. Did not find any comment blocks in: ${code}`\n      return cb(new Error(msg))\n    }\n\n    var head = commentBlocks[0].raw.join('\\n')\n    var body = code.replace(head, '')\n    body = body.replace(patFuncStart, '')\n    body = body.replace(patFuncEnd, '')\n    var headKeys = this._headKeys(commentBlocks[0].clean)\n\n    // Parse fucntion signature\n    var funcSigMatch = code.match(patFuncStart)\n    if (!funcSigMatch) {\n      return cb(new Error('Unable to parse ' + name))\n    }\n\n    var params = {\n      headKeys: headKeys,\n      body: body,\n      head: head,\n      name: name,\n      filepath: filepath,\n      codepath: codepath,\n      code: code,\n      language: language,\n      category: category,\n      func_signature: funcSigMatch[0],\n      func_name: funcSigMatch[1],\n      func_arguments: funcSigMatch[2].split(/,\\s*/),\n      commentBlocks: commentBlocks\n    }\n\n    this._findDependencies(filepath, params, {}, function (err, dependencies) {\n      if (err) {\n        return cb(err)\n      }\n\n      params.dependencies = dependencies\n      return cb(null, params)\n    })\n  }\n\n  _commentBlocks (code) {\n    var cnt = 0\n    var comment = []\n    var commentBlocks = []\n    var i = 0\n    var lines = []\n    var raise = false\n    for (i in (lines = code.replace('\\r', '').split('\\n'))) {\n      // Detect if line is a comment, and return the actual comment\n      if ((comment = lines[i].match(/^\\s*(\\/\\/|\\/\\*|\\*)\\s*(.*)$/))) {\n        if (raise === true) {\n          cnt = commentBlocks.length\n          raise = false\n        }\n        if (!commentBlocks[cnt]) {\n          commentBlocks[cnt] = {\n            clean: [],\n            raw: []\n          }\n        }\n\n        commentBlocks[cnt].clean.push(comment[2].trim())\n        commentBlocks[cnt].raw.push(lines[i])\n      } else {\n        raise = true\n      }\n    }\n\n    return commentBlocks\n  }\n\n  _headKeys (headLines) {\n    var i\n    var keys = {}\n    var match = []\n    var dmatch = []\n    var key = ''\n    var val = ''\n    var num = 0\n\n    for (i in headLines) {\n      if (!(match = headLines[i].match(/^\\s*\\W?\\s*([a-z 0-9]+)\\s*:\\s*(.*)\\s*$/))) {\n        continue\n      }\n      key = match[1]\n      val = match[2]\n\n      if ((dmatch = key.match(/^(\\w+)\\s+(\\d+)$/))) {\n        // Things like examples and notes can be grouped\n        key = dmatch[1]\n        num = dmatch[2] - 1\n      } else {\n        num = 0\n      }\n\n      if (!keys[key]) {\n        keys[key] = []\n      }\n      if (!keys[key][num]) {\n        keys[key][num] = []\n      }\n      keys[key][num].push(val)\n    }\n\n    return keys\n  }\n}\n\nmodule.exports = Util\n"]}